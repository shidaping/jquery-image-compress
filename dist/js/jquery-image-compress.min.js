"use strict";!function(e){e.extend({readAsDataURL:function(e,t){var a=new FileReader;a.onload=function(e){t(e.target.result)},a.readAsDataURL(e)},dataURLtoBlob:function(e){for(var t=e.split(","),a=t[0].match(/:(.*?);/)[1],r=atob(t[1]),n=r.length,o=new Uint8Array(n);n--;)o[n]=r.charCodeAt(n);return new Blob([o],{type:a})},imageCompress:function(){function t(e,t){var a,t=t||.1,r=e.src.length,n=e.width,o=e.height;(a=n*o/4e6)>1?(a=Math.sqrt(a),n/=a,o/=a):a=1;var l=document.createElement("canvas"),g=l.getContext("2d");l.width=n,l.height=o,g.fillStyle="#fff",g.fillRect(0,0,l.width,l.height);var i;if((i=n*o/1e6)>1){i=~~(Math.sqrt(i)+1);var s=~~(n/i),u=~~(o/i),c=document.createElement("canvas"),d=c.getContext("2d");c.width=s,c.height=u;for(var h=0;i>h;h++)for(var f=0;i>f;f++)d.drawImage(e,h*s*a,f*u*a,s*a,u*a,0,0,s,u),g.drawImage(c,h*s,f*u,s,u)}else g.drawImage(e,0,0,n,o);var m=l.toDataURL("image/jpeg",t);return console.log("压缩前："+r),console.log("压缩后："+m.length),console.log("压缩率："+~~(100*(r-m.length)/r)+"%"),m}var a,r,n={};if(arguments.length<2)return console.error("at least 2 arguments needed");if(2==arguments.length&&(a=arguments[0],r=arguments[1]),3==arguments.length&&(a=arguments[0],n=arguments[1],r=arguments[2]),!a)return console.error("file is null");var o=function(e,t){var a=new FileReader;a.onload=function(e){t(e.target.result)},a.readAsDataURL(e)},l={quality:.1},n=e.extend(l,n);o(a,function(e){var a=new Image;a.src=e;var o=t(a,n.quality);r(o)})}})}(jQuery);